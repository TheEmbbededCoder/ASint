<!DOCTYPE html>
<html>
  <head>
    <title>Instascan</title>
    <script type="text/javascript" src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js" ></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
</head>
  <body>
    <video id="preview"></video>
    <div id="clickme">Click here to open scanner :)</div>
    <div id="infoDisp"></div>
    <script>
        let scanner = new Instascan.Scanner(
            {
                video: document.getElementById('preview')
            }
        );
        scanner.addListener('scan', function(content) {
            //window.open(content, "_blank");
            var arrayLink = content.split('/');
            var i;
            content = arrayLink[0];
            for(i = 1; i < arrayLink.length; i++){
                content = content + '/';
                content = content + arrayLink[i];
                if(i == 2){
                    content = content + '/';
                    content = content + "API";
                }
            }
            
            $.getJSON(content, function(data) {
                $("#preview").hide();
                scanner.stop();
                console.log(data);
                
                var arr = content.split('/');
                console.log(arr);
                if(arr[arr.length-1]=="secretariat"){
                    var i = 1;
                    $("#infoDisp").empty();
                    $.each( data.secretariat, function( key, val ) { 
                        var items = [];
                        items.push("<h3>Secretariat " + i.toString()+"</h3>");
                        i = i+1;
                        $.each( val, function( key, val ) {
                            items.push("<li id='" + key + "'>" +key + ":"+ val + "</li>" );
                            
                        });
                        $( "<ul/>", {
                            "class": "secretariat-list",
                            html: items.join( "" )
                        }).appendTo( "#infoDisp" );
                    }); 
                }
                
                
                
            });
        });
        $( "#clickme" ).click(function() {
            $( "#preview" ).show( "slow", function() {
                // Animation complete.
            });
            Instascan.Camera.getCameras().then(cameras => 
            {
                if(cameras.length > 0){
                    scanner.start(cameras[0]);
                } else {
                    console.error("Please enable Camera!");
                }
            });
        });
        
    </script>

 </body>
</html>
</html>